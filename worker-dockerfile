FROM awst/qa4sm-base:latest
RUN apt-get update && apt-get -y install apt-utils
RUN apt-get -y install curl gfortran libgeos-dev build-essential qt5-default rsync libproj-dev wget git cron
ADD ./ /tmp/qa4sm-git

COPY ./docker/base/run_autocleanup.sh /var/lib/qa4sm-web-val/valentina/run_autocleanup.sh
COPY ./docker/base/cronjob /etc/cron.d/cronjob

# Giving executable permission to crontab file
RUN chmod 0644 /etc/cron.d/cronjob

# Running crontab
RUN crontab /etc/cron.d/cronjob

RUN bash /tmp/qa4sm-git/docker/celery-w/install.sh
COPY ./docker/celery-w/entrypoint.sh /usr/bin/entrypoint.sh
COPY ./docker/celery-w/entrypoint.sh /usr/local/bin/


RUN ln -s usr/local/bin/entrypoint.sh /entrypoint.sh # backwards compat
ENTRYPOINT ["entrypoint.sh"]
