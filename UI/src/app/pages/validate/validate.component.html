<div class="p-grid no-gutters" [ngClass]="{'non-scrollable': isExistingValidationWindowOpen}">
  <div class="
    p-col-12
    p-md-10 p-md-offset-1
    p-lg-10 p-lg-offset-1
    p-xl-8 p-xl-offset-2">

    <div *ngIf="!maintenanceMode" class="p-grid" style="justify-content: center">

      <!--  data column-->
      <div class="p-md-5 p-col-10">
        <p-panel header="Data" [toggleable]="true" class="validation-small-row">
          <ng-template pTemplate="icons">
            <label class="p-panel-header-icon"
                   pTooltip="The soil moisture dataset which is to be validated, i.e. compared to the 'Reference' data."
                   tooltipPosition="bottom">
              <span class="pi pi-question-circle"></span>
            </label>
          </ng-template>
          <p-accordion multiple="true">

            <p-accordionTab *ngFor="let item of validationModel.datasetConfigurations; let datasetIdx = index"
                            [header]="(item.datasetModel.selectedDataset?.pretty_name)+' / ' +
                             ''+(item.datasetModel.selectedVersion?.pretty_name)+' / '+(item.datasetModel.selectedVariable?.short_name)
                             + (validationConfigService.getInformationOnTheReference((item.spatialReference$|async), (item.temporalReference$|async), (item.scalingReference$|async)))"
                            [selected]="datasetIdx == validationModel.datasetConfigurations.length - 1"
                            [class]="{'highlighted': (item.highlighted$|async),
                            'is-reference': ((item.spatialReference$|async) || (item.temporalReference$|async) || (item.scalingReference$|async))}">

              <qa-dataset *ngIf="validationModel.datasetConfigurations[datasetIdx].datasetModel.selectedDataset"
                          [selectionModel]="validationModel.datasetConfigurations[datasetIdx].datasetModel"
                          [removable]="true" (changeDataset)="onDatasetChange($event)"></qa-dataset>

              <ng-container *ngFor="let filter of item.basicFilters; let filterIdx = index">
                <qa-basic-filter
                  [ngClass]="{'ml-1': isIncluded(filter.filterDto.id, item.basicFilters)}"
                  [isIncluded]="isIncluded(filter.filterDto.id, item.basicFilters)"
                  [filterModel]="filter"
                  (onExcludeMutual)="this.excludeFilter($event, item.basicFilters)"
                  (onIncludeMutual)="this.includeFilter($event, item.basicFilters, filter.enabled)">
                </qa-basic-filter>
              </ng-container>

              <qa-threshold-filter *ngIf="validationModel.datasetConfigurations[datasetIdx].smosRfiFilter$|async"
                                   [datasetModel]="validationModel.datasetConfigurations[datasetIdx].datasetModel"
                                   [filterModel$]="validationModel.datasetConfigurations[datasetIdx].smosRfiFilter$"
                                   [minThreshold]="0." [increment]="0.05" maxThreshold="1." [units]="' [-]'">
              </qa-threshold-filter>

              <qa-threshold-filter *ngIf="validationModel.datasetConfigurations[datasetIdx].smosChi2Filter$|async"
                                   [datasetModel]="validationModel.datasetConfigurations[datasetIdx].datasetModel"
                                   [filterModel$]="validationModel.datasetConfigurations[datasetIdx].smosChi2Filter$"
                                   [minThreshold]="0." [increment]="0.05" maxThreshold="1." [units]="' [-]'">
              </qa-threshold-filter>
              <div *ngIf="validationModel.datasetConfigurations[datasetIdx].ismnNetworkFilter$|async">
                <qa-ismn-network-filter

                  [datasetModel]="validationModel.datasetConfigurations[datasetIdx].datasetModel"
                  [filterModel$]="validationModel.datasetConfigurations[datasetIdx].ismnNetworkFilter$"></qa-ismn-network-filter>
              </div>
              <div *ngIf="validationModel.datasetConfigurations[datasetIdx].ismnDepthFilter$|async">
                <qa-ismn-depth-filter
                  [datasetModel]="validationModel.datasetConfigurations[datasetIdx].datasetModel"
                  [filterModel$]="validationModel.datasetConfigurations[datasetIdx].ismnDepthFilter$">
                </qa-ismn-depth-filter>
              </div>

              <div style="width: 100%;text-align: right">
                <button pButton type="button"
                        [disabled]="validationModel.datasetConfigurations.length < 3"
                        (click)="removeDataset(validationModel.datasetConfigurations[datasetIdx])"
                        label="Remove dataset"
                        icon="pi pi-trash"
                        class="removeDataset p-button-danger p-my-2"
                        style="padding: 0.2rem;">
                </button>
              </div>
            </p-accordionTab>

          </p-accordion>
          <button pButton
                  type="button"
                  label="Add dataset"
                  icon="pi pi-plus-circle"
                  (click)="addDatasetToValidate()"
                  class="addDataset p-button-success p-my-2"
                  style="padding: 0.2rem;"
                  [disabled]="addDatasetButtonDisabled()">
          </button>

        </p-panel>
      </div>


      <div class="p-md-5 p-col-10">
        <!--  reference column-->
        <p-panel header="Reference" [toggleable]="true" class="validation-small-row">
          <ng-template pTemplate="icons">
            <label class="p-panel-header-icon"
                   pTooltip="The data which is to be used as a reference in the validation. The 'Data' will be compared against this reference."
                   tooltipPosition="bottom">
              <span class="pi pi-question-circle"></span>
            </label>
          </ng-template>

          <!--             spatial reference-->
          <div class="p-pt-2">
            <label for="spatial-reference" class="p-mb-4">Spatial reference:</label>
            <qa-validation-reference
              id="spatial-reference"
              #spatialReference
              [validationModel]="validationModel"
              [referenceType]="'spatialReference$'"
              (hoverOverDataset)="onHoverOverReferenceDataset($event)"></qa-validation-reference>
          </div>

          <!--             temporal reference-->
          <div>
            <label for="temporal-reference" class="p-mb-4">Temporal reference:</label>
            <qa-validation-reference
              id="temporal-reference"
              #temporalReference
              [validationModel]="validationModel"
              [referenceType]="'temporalReference$'"
              (hoverOverDataset)="onHoverOverReferenceDataset($event)"></qa-validation-reference>
          </div>


        </p-panel>


        <!--      Scaling-->
<!--        <p-panel header="Reference" [toggleable]="true" class="validation-small-row">-->
<!--          <div class="p-col-10">-->
            <qa-scaling
              [validationModel]="validationModel"
              (hoverOverDataset)="onHoverOverReferenceDataset($event)"
            ></qa-scaling>
<!--          </div>-->
<!--        </p-panel>-->


      </div>

      <!--      Map-->
      <div class="p-col-10">
        <p-panel toggleable="true" [header]="'Map'" styleClass="map-panel" collapsed="true" class="validation-row">
          <qa-map class="map" #qwerty
                  [spatialSubset]="validationModel.spatialSubsetModel"
                  [center]="[10, 52.5]"
                  [zoom]="2.5"></qa-map>
        </p-panel>

      </div>

      <!--      Spatial subsetting-->
      <div class="p-col-10">
        <qa-spatial-subset [subsetModel]="validationModel.spatialSubsetModel"></qa-spatial-subset>
      </div>


      <p-panel header="Temporal Subsetting" [toggleable]="true" class="validation-row p-col-10">
        <ng-template pTemplate="icons">
          <label class="p-panel-header-icon"
                 pTooltip="Select validation period and temporal matching window."
                 tooltipPosition="bottom">
            <span class="pi pi-question-circle"></span>
          </label>
        </ng-template>

        <!--      Validation period-->
        <div>
          <qa-validation-period [validationPeriodModel]="validationModel.validationPeriodModel"></qa-validation-period>
        </div>
        <!--      Temporal matching-->
        <div>
          <qa-temporal-matching [temporalMatchingModel]="validationModel.temporalMatchingModel"></qa-temporal-matching>
        </div>

      </p-panel>


      <!--      Metrics-->
      <div class="p-col-10">
        <qa-metrics [validationModel]="validationModel"></qa-metrics>
      </div>


      <!--      Anomalies-->
      <div class="p-col-10">
        <qa-anomalies [anomaliesModel]="validationModel.anomalies"></qa-anomalies>
      </div>

      <!--      &lt;!&ndash;      Scaling&ndash;&gt;-->
      <!--      <div class="p-col-10">-->
      <!--        <qa-scaling [validationModel]="validationModel"></qa-scaling>-->
      <!--      </div>-->

      <!-- Name -->
      <div class="p-col-10">
        <div class="p-grid p-px-2">
            <span class="label p-col-1">
              <label for="name">Name your validation</label>
            </span>
          <input class="form-field p-col"
                 id="name"
                 type="text"
                 pInputText
                 [ngModel]="validationModel.nameTag$|async"
                 (ngModelChange)="validationModel.nameTag$.next($event)">
          <span
            pTooltip="You can optionally name the validation to make it easier to identify in your list of validations."
            class="pi pi-question-circle p-col-1 help-field">
          </span>
        </div>
      </div>

      <div class="p-col-10">
        <div>
          <div class="p-d-flex p-jc-center">
            <p-button id="validateButton" label="Validate" icon="pi pi-play"
                      (onClick)="startValidation(true)"></p-button>
          </div>
        </div>
      </div>

    </div>

    <div *ngIf="maintenanceMode" class="container text-center mb-5 mt-4" style="max-width: 40rem;">
      <h1 class="jumbotron-heading">Maintenance...</h1>
      <p class="lead text-muted">Sorry! Currently, you can't start new validations because we're doing maintenance on
        the service. Please come back later.</p>
    </div>

  </div>
  <qa-existing-validation *ngIf="isExistingValidationWindowOpen"
                          [isThereValidation]="isThereValidation"
                          (startValidation)="startValidation(false)">
  </qa-existing-validation>
</div>
<qa-scroll-to-top></qa-scroll-to-top>
