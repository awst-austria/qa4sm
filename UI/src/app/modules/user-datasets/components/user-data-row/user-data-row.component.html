<p-panel class="validation-row">

  <ng-template pTemplate="header">
    <h5 class="p-my-0"><span class="font-weight-normal">Size: </span> {{ getTheFileSize() }}</h5>
  </ng-template>
  <ng-template pTemplate="icons" class="font-weight-normal">
    <h5 class="p-my-0"> Upload date: {{userDataset.upload_date| date: dateFormat :timeZone}} UTC
    </h5>
  </ng-template>
  <div class="p-grid p-mx-0 p-px-0 p-my-0">
    <!--    dataset -->
    <div class="p-col-5">
      <div><strong>Dataset: </strong></div>


      <div
        *ngIf="!editDataset.opened"
        style="cursor: pointer"
        pTooltip="Click to change the name."
        tooltipPosition="bottom"
        (click)="toggle(datasetFieldName, true)"
      > Name: <b>{{(datasetName$| async)}} </b>
        <span class="pi pi-pencil small-edit-icon"></span>
      </div>

      <div *ngIf="editDataset.opened">
        <label for="new-dataset-name">Name: </label>
        <input id="new-dataset-name"
               type="text"
               value="{{datasetName$|async}}"
               #newDatasetName
               [ngClass]="{'edit_dataset': true}">
        <button
          pButton
          type="button"
          icon="pi pi-save"
          [ngClass]="{'btn-action save_name_black_btn': true}"
          pTooltip="Save Name"
          (click)="updateMetadata(datasetFieldName, newDatasetName.value, userDataset.id)">
        </button>
        <button
          pButton
          type="button"
          icon="pi pi-ban"
          [ngClass]="{'btn-action cancel_black_btn': true}"
          pTooltip="Cancel"
          (click)="toggle(datasetFieldName, false)">
        </button>
      </div>


      <div
        *ngIf="!editVersion.opened"
        style="cursor: pointer"
        pTooltip="Click to change the name."
        tooltipPosition="bottom"
        (click)="toggle(versionFieldName, true)"
      > Version: <b>{{(versionName$ | async)}} </b>
        <span class="pi pi-pencil small-edit-icon"></span>
      </div>

      <div *ngIf="editVersion.opened">
        <label for="new-version-name">Version: </label>
        <input id="new-version-name"
               type="text"
               value="{{versionName$|async}}"
               #newVersionName
               [ngClass]="{'edit_dataset': true}">
        <button
          pButton
          type="button"
          icon="pi pi-save"
          [ngClass]="{'btn-action save_name_black_btn': true}"
          pTooltip="Save Name"
          (click)="updateMetadata(versionFieldName, newVersionName.value, userDataset.id)">
        </button>
        <button
          pButton
          type="button"
          icon="pi pi-ban"
          [ngClass]="{'btn-action cancel_black_btn': true}"
          pTooltip="Cancel"
          (click)="toggle(versionFieldName, false)">
        </button>
      </div>


      <span
        *ngIf="!(editVariable.opened)"
        (click)="toggle(variableFieldName,true)"
        style="cursor: pointer"
        pTooltip="You can choose another name by clicking here. Please note, if the chosen variable name is incorrect, data validation won't be possible."
      >
        Variable: <b>{{(variableName.shortName$|async)}} ({{variableName.prettyName$|async}}) </b>
        <span class="pi pi-question-circle small-edit-icon"></span>
        </span>
      <div *ngIf="(editVariable.opened)">
        <label for="variable-dropdown">Variable: </label>
        <p-dropdown
          id="variable-dropdown"
          class="form-field"
          [options]="(userDataset.all_variables)"
          [ngModel]="(variableName.shortName$|async)"
          (ngModelChange)="updateMetadata(variableFieldName, $event, userDataset.id)"
          [style]="{'width':'6rem', 'height': '2rem'}"
          optionLabel="name"
          optionValue="name"
          placeholder="Choose"
          editable="true"
          ngDefaultControl>
        </p-dropdown>
        <button
          pButton
          type="button"
          icon="pi pi-ban"
          [ngClass]="{'btn-action cancel_black_btn': true}"
          pTooltip="Cancel"
          (click)="toggle(variableFieldName,false)">
        </button>
      </div>
    </div>
    <!-- coordinates - we don't show coordinates anymore, but I'll leave this space here-->
    <div class="p-col-5" [style]="{height: '100%'}">
      <div><strong>Validation list: </strong></div>
      <p-scrollPanel [style]="{width: '100%', height: '100px'}">
              <div *ngFor="let validation of userDataset.validation_list">
                  <a routerLink="/validation-result/{{validation.val_id}}"
                     pTooltip="View validation">{{validation.val_name}}</a>
              </div>
      </p-scrollPanel>


<!--      </span>-->
<!--      <p-dropdown-->
<!--        id="vvalidation-list"-->
<!--        class="form-field"-->
<!--        [options]="(userDataset.validation_list)"-->
<!--        [style]="{'width':'6rem', 'height': '2rem'}"-->
<!--        optionLabel="val_name"-->
<!--        placeholder="Choose"-->
<!--        ngDefaultControl>-->
<!--      </p-dropdown>-->



    </div>
    <!-- actions   -->
    <div class="p-col status">
      <div
        [pTooltip]="userDataset.is_used_in_validation ? 'Dataset has been used in a validation, it can not be removed' : ''"
        tooltipPosition="left"
      >
        <button pButton
                icon="pi pi-times"
                type="button"
                label="Remove dataset"
                pTooltip="Remove dataset and the attached file"
                class="p-button-danger"
                [disabled]="userDataset.is_used_in_validation"
                [style]="{'width':'8rem', 'height': '2.5rem', 'margin-right': '0.5rem'}"
                (click)="removeDataset(userDataset.id)">
        </button>
      </div>
    </div>
  </div>

</p-panel>

