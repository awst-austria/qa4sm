<p-panel class="user-data-row">

  <ng-template pTemplate="header">
    <h5 class="my-0"><span class="font-weight-normal">Size: </span> {{ getTheFileSize() }}</h5>
  </ng-template>
  <ng-template pTemplate="icons" class="font-weight-normal">
    <h5 class="my-0"> Upload date: {{userDataset.upload_date| date: dateFormat :timeZone}} UTC
    </h5>
  </ng-template>
  <div class="grid mx-0 px-0 my-0" *ngIf="userDataset.metadata_submitted" [style]="{height: '100%'}">
    <!--    dataset -->
    <div [ngClass]="authService.currentUser.is_staff ? 'col-4' : 'col-5'">
      <div><strong>Dataset: </strong></div>


      <div
        *ngIf="!editDataset.opened"
        style="cursor: pointer"
        pTooltip="Click to change the name."
        tooltipPosition="bottom"
        (click)="toggle(datasetFieldName, true)"
      > Name: <b>{{(datasetName$| async)}} </b>
        <span class="pi pi-pencil small-edit-icon"></span>
      </div>

      <div *ngIf="editDataset.opened">
        <label for="new-dataset-name">Name: </label>
        <input id="new-dataset-name"
               type="text"
               value="{{datasetName$|async}}"
               #newDatasetName
               [ngClass]="{'edit_dataset': true}">
        <button
          pButton
          type="button"
          icon="pi pi-save"
          [ngClass]="{'btn-action save_name_black_btn': true}"
          pTooltip="Save Name"
          (click)="updateMetadata(datasetFieldName, newDatasetName.value, userDataset.id)">
        </button>
        <button
          pButton
          type="button"
          icon="pi pi-ban"
          [ngClass]="{'btn-action cancel_black_btn': true}"
          pTooltip="Cancel"
          (click)="toggle(datasetFieldName, false)">
        </button>
      </div>


      <div
        *ngIf="!editVersion.opened"
        style="cursor: pointer"
        pTooltip="Click to change the name."
        tooltipPosition="bottom"
        (click)="toggle(versionFieldName, true)"
      > Version: <b>{{(versionName$ | async)}} </b>
        <span class="pi pi-pencil small-edit-icon"></span>
      </div>

      <div *ngIf="editVersion.opened">
        <label for="new-version-name">Version: </label>
        <input id="new-version-name"
               type="text"
               value="{{versionName$|async}}"
               #newVersionName
               [ngClass]="{'edit_dataset': true}">
        <button
          pButton
          type="button"
          icon="pi pi-save"
          [ngClass]="{'btn-action save_name_black_btn': true}"
          pTooltip="Save Name"
          (click)="updateMetadata(versionFieldName, newVersionName.value, userDataset.id)">
        </button>
        <button
          pButton
          type="button"
          icon="pi pi-ban"
          [ngClass]="{'btn-action cancel_black_btn': true}"
          pTooltip="Cancel"
          (click)="toggle(versionFieldName, false)">
        </button>
      </div>


      <span
        *ngIf="!(editVariable.opened)"
        (click)="toggle(variableFieldName,true)"
        style="cursor: pointer"
        [class]="(variableName.shortName$|async) !== '--none--' ? '' : 'warning'"
        pTooltip="{{(variableName.shortName$|async) !== '--none--' ?
        'You can choose another name by clicking here. Please note, if the chosen variable name is incorrect, data validation will not be possible.' :
        'We could not retrieve the applicable soil moisture variable name. Please choose the proper one from the list. A validation will fail if no proper variable is set.'}}"
      >
        Variable: <b>{{(variableName.shortName$|async)}} ({{variableName.prettyName$|async}}
        ) [{{variableName.unit$|async}}] </b>
        <span class="pi pi-question-circle small-edit-icon"></span>
        </span>
      <div *ngIf="(editVariable.opened)">
        <label for="variable-dropdown">Variable: </label>
        <p-dropdown
          id="variable-dropdown"
          class="form-field"
          [options]="(userDataset.all_variables)"
          [ngModel]="(variableName.shortName$|async)"
          (ngModelChange)="updateMetadata(variableFieldName, $event, userDataset.id)"
          [style]="{'width':'6rem', 'height': '2rem'}"
          optionLabel="name"
          optionValue="name"
          placeholder="Choose"
          editable="true"
          ngDefaultControl>
        </p-dropdown>
        <button
          pButton
          type="button"
          icon="pi pi-ban"
          [ngClass]="{'btn-action cancel_black_btn': true}"
          pTooltip="Cancel"
          (click)="toggle(variableFieldName,false)">
        </button>
      </div>
    </div>
    <!-- validations -->
    <div class="p-fluid" [style]="{height: '100%'}" [ngClass]="authService.currentUser.is_staff ? 'col-4' : 'col-5'">
      <div><strong>Validation list: </strong></div>
      <p-scrollPanel  [style]="{width: '80%', height: '80%'}">
        <div *ngIf="userDataset.validation_list.length > 0">
          <div *ngFor="let validation of userDataset.validation_list; index as ind">
            {{ind + 1}}) <a routerLink="/validation-result/{{validation.val_id}}"
                            pTooltip="View validation">{{validation.val_name}}</a>
          </div>
        </div>

        <div class="no-validation-box" *ngIf="userDataset.validation_list.length === 0">
          <em> No validation has been run with this data </em>
        </div>

      </p-scrollPanel>

    </div>

    <!-- sharing groups-->
    <div *ngIf="authService.currentUser.is_staff" class="p-fluid col-2" [style]="{height: '100%', width: '20%'}">
      <div><strong>Shared: </strong></div>
      <p-scrollPanel *ngIf="(dataManagementGroups$|async) as managementGroups" [style]="{width: '80%', height: '80%'}">
        <div *ngIf="managementGroups.length !== 0">
          <div *ngFor="let group of managementGroups; index as ind">
            {{ind + 1}}) {{group.name}}
          </div>
        </div>
        <div class="no-validation-box" *ngIf="managementGroups.length === 0">
          <em> The data set has not been shared </em>
        </div>
      </p-scrollPanel>
    </div>



    <!-- actions   -->
    <div class="status col-2" [style]="{width: '12%'}">
      <div
        [pTooltip]="userDataset.is_used_in_validation ? 'Dataset has been used in a validation, it can not be removed' : ''"
        tooltipPosition="left">
        <button pButton
                icon="pi pi-times"
                type="button"
                label="Remove dataset"
                pTooltip="Remove dataset and the attached file"
                class="p-button-danger"
                [disabled]="userDataset.is_used_in_validation"
                [style]="{'width':'8rem', 'height': '2.5rem', 'margin-right': '0.5rem'}"
                (click)="removeDataset(userDataset.id)">
        </button>
      </div>
    </div>
  </div>
  <div class="grid mx-0 px-0 my-0 no-validation-box" *ngIf="!userDataset.metadata_submitted" [style]="{height: '100%'}">
     <h4> <span class="pi pi-spin pi-spinner" style="font-size: 2rem"></span><em> Your file is still being preprocessed. </em> </h4>
  </div>

</p-panel>

