<div class="grid mx-0">
  <div class="col-12">
    <p-panel>
      <ng-template pTemplate="header">
        <div class="text-center" style="width: 95%">
          <h4 class="my-0 py-0 font-weight-normal">Result files</h4>
        </div>
      </ng-template>
      <ng-template pTemplate="icons">
      </ng-template>
      <div *ngIf="updatedMetrics$|async as metrics" style="min-height: 400px">
        <div *ngIf="metrics[metricIndx] && metrics[metricIndx].boxplotFiles|async as boxplots">
          <div *ngIf="metrics[metricIndx].overviewFiles|async as overviewPlots">
            <div class="grid align-content-center">
              <div *ngIf="boxplots.length > 0"
                   [ngClass]="{'col-5': overviewPlots.length === 1, 'col-6': overviewPlots.length > 1}">
                <p-galleria [value]="boxplots"
                            [(visible)]="displayBoxplotGallery"
                            [(activeIndex)]="activeBoxplotIndex"
                            [circular]="true"
                            [fullScreen]="true"
                            [showItemNavigators]="boxplots.length > 1"
                            [showThumbnails]="false"
                            [baseZIndex]="100000">
                  <ng-template pTemplate="item" let-item>
                    <img [src]="sanitizePlotUrl(item.plot)"
                         alt="Boxplot for {{metrics[metricIndx].metric_pretty_name}}"
                         style="width: 100%;
                             display: block;"/>
                  </ng-template>
                </p-galleria>
                <img width="95%"
                     height="95%"
                     [src]="sanitizePlotUrl(boxplots[boxplotIndx].plot)"
                     (click)="showGallery(boxplotIndx, 'boxplot')"
                     [ngClass]="{'result-plot':true, 'pcol': overviewPlots.length > 4}"
                     alt="Boxplot for {{metrics[metricIndx].metric_pretty_name}}">
              </div>
              <div class="col">
                <div class="grid">
                  <div *ngFor="let plot of overviewPlots; let ind = index"
                       [ngClass]="{'image-container': true,
                             'col': overviewPlots.length === 1,
                             'col-10': overviewPlots.length === 2,
                             'col-6': overviewPlots.length > 2}">
                    <span class="image-label">
                      {{metrics[metricIndx].datasets[ind]}}
                    </span>
                    <p-galleria [value]="overviewPlots"
                                [(visible)]="displayOverviewGallery"
                                [(activeIndex)]="activeOverviewIndex"
                                [circular]="true"
                                [fullScreen]="true"
                                [showItemNavigators]="overviewPlots.length > 1"
                                [showThumbnails]="false"
                                [baseZIndex]="100000">
                      <ng-template pTemplate="item" let-item>
                        <img [src]="sanitizePlotUrl(item.plot)"
                             alt="An Overview map for {{metrics[metricIndx].metric_pretty_name}}"
                             style="width: 100%;
                             display: block;"/>
                      </ng-template>
                    </p-galleria>
                    <img width="95%" height="95%"
                         [src]="sanitizePlotUrl(plot.plot)"
                         (click)="showGallery(ind, 'overview')"
                         [ngClass]="{'result-plot':true, 'pcol': true}"
                         alt="An Overview map for {{metrics[metricIndx].metric_pretty_name}}">
                  </div>
                </div>
              </div>

            </div>

          </div>
          <div class="grid" *ngIf="boxplots.length > 1">
            <div class="col-6">
                  <span class="p-float-label mb-4 mt-3">
                      <p-dropdown id="boxplotSelector"
                                  (onChange)="onBoxPlotChange($event)"
                                  [options]="metrics[metricIndx].boxplot_dicts"
                                  [(ngModel)]="selectedBoxplot"
                                  optionLabel="name"
                                  [style]="{'width': '100%'}">
                      </p-dropdown>
                      <label for="boxplotSelector">Select boxplot classification</label>
                    </span>
            </div>
          </div>
          <div [ngClass]="{'grid': true, 'pt-3': boxplots.length === 1}">
            <div [ngClass]="{'col-6': true}">
              <span class="p-float-label mb-4">
                <p-dropdown id="metricSelector"
                            (onChange)="onMetricChange($event)"
                            [options]="metrics"
                            [(ngModel)]="selectedMetrics"
                            optionLabel="metric_pretty_name"
                            [style]="{'width': '100%'}">
                </p-dropdown>
                <label for="metricSelector">Select boxplot/map metric</label>
              </span>
            </div>
            <div class="col-3 px-0 center">
              <button pButton
                      type="button"
                      icon="pi pi-download"
                      class="btn-action-large download-results"
                      label="Download graphs"
                      pTooltip="Download graphs .zip"
                      [life]="globals.tooltipLifetime"
                      (click)="downloadResultFile(validation.id, 'graphics',validation.id + '_graphs.zip')">
              </button>
            </div>

            <div class="col-3 px-0 center">
              <button pButton
                      type="button"
                      class="btn-action-large download-results"
                      icon="faIcons.faFileDownload"
                      label="Download NetCDF"
                      pTooltip="Download all results in NetCDF format"
                      [life]="globals.tooltipLifetime"
                      (click)="downloadResultFile(validation.id, 'netCDF', validation.output_file_name)">
                <span><fa-icon [icon]="faIcons.faFileDownload"></fa-icon></span>
              </button>
            </div>
          </div>
        </div>
      </div>

    </p-panel>
  </div>
</div>
