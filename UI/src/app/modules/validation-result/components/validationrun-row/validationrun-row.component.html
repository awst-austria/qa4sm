<p-panel *ngIf="configurations$|async as configurations" class="validation-row">
  <!--Header-->
  <!-- PUBLISHED  -->
  <ng-template *ngIf="published" pTemplate="header">
    <h5 class="p-my-0"><span class="font-weight-normal">Name:</span> {{ valName$|async }}</h5>
  </ng-template>
  <ng-template *ngIf="published" pTemplate="icons" class="doilink">
    <h5 class="p-my-0"> DOI: <a class="doilink" target="_blank"
                                href="{{this.getDoiPrefix()}}{{ validationRun.doi }}">{{ validationRun.doi }}</a>
    </h5>
  </ng-template>
  <!--  CUSTOM    -->
  <ng-template *ngIf="!published" pTemplate="header">
    <h5 class="p-my-0">
      <!--      if there is expiry date property: -->
      <span *ngIf="validationRun.expiry_date">
          <span *ngIf="validationRun.is_near_expiry && validationRun.progress !== -1" class="p-panel-header-icon pi pi-exclamation-triangle expiry-icons"
                title="'This validation will SOON be automatically removed during cleanup on {{ validationRun.expiry_date|date: dateFormat :timeZone}} {{timeZone}}."></span>
          <span *ngIf="!validationRun.is_near_expiry && validationRun.progress !== -1" class="p-panel-header-icon pi pi-calendar expiry-icons"
                title="This validation will be automatically removed during cleanup on {{ validationRun.expiry_date|date: dateFormat :timeZone }} {{timeZone}}.">
          </span>
          <span *ngIf="validationRun.progress === -1" class="p-panel-header-icon pi pi-ban expiry-icons"
                        title="This validation was cancelled.">
          </span>
      </span>
      <!--      if there is no expiry date property: -->
      <span *ngIf="!validationRun.expiry_date">
          <span *ngIf="!validationRun.end_time && validationRun.progress <= 100"
                class="p-panel-header-icon pi pi-spin pi-spinner expiry-icons"
                title="This validation is still running."></span>

          <a class="doilink" target="_blank" href="{{getDoiPrefix()}}{{ validationRun.doi }}" rel="noreferrer">
            <span *ngIf="validationRun.doi" class="p-panel-header-icon pi pi-book expiry-icons"
                  title="This result has been published with zenodo. It will NOT be automatically removed during cleanup.">
            </span>
          </a>
        <span *ngIf="validationRun.is_archived && validationRun.is_unpublished"
              class="p-panel-header-icon pi pi- expiry-icons"
              title="This validation has been archived. It will NOT be automatically removed during cleanup.">
          <fa-icon [icon]="faIcons.faArchive"></fa-icon>
        </span>
      </span>

      <span *ngIf="!validationRun.is_a_copy" class="font-weight-normal"> Started:
        {{ validationRun.start_time|date: dateFormat :timeZone }} {{timeZone}}
      </span>
      <span *ngIf="validationRun.is_a_copy" class="font-weight-normal">
        Copied: {{ validationRun.start_time|date: dateFormat :timeZone }} {{timeZone}} <br>
        (Date of original run: {{ originalDate|date: 'mediumDate' :timeZone }})
      </span>

    </h5>
  </ng-template>
  <ng-template *ngIf="!published" pTemplate="icons" style="min-width: 7rem; max-width: 15rem">
    <h5 class="p-my-0">
      <span *ngIf="hideElement"
            class=" font-weight-normal">
        Name: {{ valName$|async }}
      </span>
      <span *ngIf="!validationRun.is_unpublished; else elseUnpublished"
            class="p-my-0 font-weight-normal">
        <span class="pi pi-question-circle help-icon"
              title="Validation has been published. There is no possibility of changing its name.">
        </span>
      </span>
      <ng-template #elseUnpublished>
        <button
          pButton
          type="button"
          icon="faIcons.faPencil"
          [ngClass]="{'btn-action edit_name_btn': true, 'hidden': !hideElement}"
          title="Change Name"
          (click)="toggleEditing()">
          <fa-icon [icon]="faIcons.faPencil"></fa-icon>
        </button>
        <span *ngIf="!hideElement">
          <label for="new-name">Name: </label>
          <input id="new-name"
                 type="text"
                 value="{{valName$|async}}"
                 #newName
                 [ngClass]="{'edit_name': true}">
          <button
            pButton
            type="button"
            icon="pi pi-save"
            [ngClass]="{'btn-action save_name_btn': true}"
            title="Save Name"
            (click)="saveName(validationRun.id, newName.value)">
          </button>
          <button
            pButton
            type="button"
            icon="pi pi-ban"
            [ngClass]="{'btn-action cancel_editing_btn': true}"
            title="Cancel"
            (click)="toggleEditing()">
          </button>
        </span>
      </ng-template>
    </h5>
  </ng-template>

  <!-- Body -->
  <!-- Datasets -->
  <div class="p-grid p-mx-0 p-px-0 p-my-0">
    <div class="p-col">
      <strong>Data:</strong><br/>
      <span *ngFor="let config of configurations">
        <span *ngIf="config.id !== validationRun.reference_configuration">
          {{config.dataset}},
          {{config.version}},
          {{config.variable}} <br>
        </span>
      </span>
    </div>
    <!-- Reference -->
    <div class="p-col">
      <strong>Reference:</strong><br/>
      <span *ngFor="let config of configurations">
        <span *ngIf="config.id === validationRun.reference_configuration">
          {{config.dataset}},
          {{config.version}},
          {{config.variable}} <br>
        </span>
      </span>
    </div>
    <!-- Status / Created   -->
    <div class="p-col status">
      <!--    PUBLISHED -->
      <div *ngIf="published">
        <strong>Created:</strong><br/>
        {{ validationRun.start_time|date:"YYYY-MM-dd" }}
      </div>
      <!--    CUSTOM -->
      <div *ngIf="!published">
        <strong>Status:</strong><br/>
        {{validationStatus$|async}}
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="p-col-3" style="max-width: 10rem">
      <qa-buttons [validationList]="true" [validationRun]="validationRun" [published]="published"></qa-buttons>
    </div>


  </div>
</p-panel>
