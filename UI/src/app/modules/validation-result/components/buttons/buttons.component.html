<!--Buttons shown on the validation list page (both custom and published)-->
<div *ngIf="validationList" class="col-sm" style="text-align: right; max-width: 25rem">
  <!--  this one will be shown on custom validation page only due to given conditions-->
  <button *ngIf="validationRun.progress > -1 && validationRun.progress < 100 && validationRun.end_time === null"
          pButton
          type="button"
          icon="faIcons.faStop"
          class="btn-action"
          title="Cancel validation"
          (click)="stopValidation(validationRun.id)">
    <span><fa-icon [icon]="faIcons.faStop"></fa-icon></span>
  </button>
  <!--  both pages -->
  <a class="btn-action"
     pButton
     type="button"
     icon="pi pi-folder-open"
     routerLink="/validation-result/{{validationRun.id}}"
     title="View results">
  </a>

  <!--custom validations only-->
  <span *ngIf="validationRun.end_time && validationRun.is_unpublished && isOwner"
        [ngClass]="{'collapse': validationRun.publishing_in_progress}">

    <button *ngIf="isArchived$|async"
            pButton
            type="button"
            icon="pi pi-calendar"
            title="Un-archive"
            class="btn-action"
            (click)="archiveResults(validationRun.id, false)">
    </button>

    <button *ngIf="!(isArchived$|async)"
            pButton
            type="button"
            icon="faIcons.faArchive"
            title="Archive"
            class="btn-action"
            (click)="archiveResults(validationRun.id, true)">
      <span><fa-icon [icon]="faIcons.faArchive"></fa-icon></span>
    </button>

  </span>

  <div *ngIf="!published && !tracked" class="dropdown">
    <button class="dropdownbutton" aria-label="collapse">
      <span class="pi pi-angle-double-right"></span>
    </button>
    <div class="dropdown-content" style="text-align: left">
      <div *ngIf="validationRun.output_file">
        <button pButton
                type="button"
                class="dropdown-item"
                icon="pi pi-download"
                label="Download Graphs"
                (click)="downloadResultFile(validationRun.id, 'graphics',validationRun.id + '_graphs.zip')"
                title="Download graphs .zip">
        </button>
        <button pButton
                type="button"
                class="dropdown-item"
                icon="faIcons.faFileDownload"
                label="Download NetCDF File"
                (click)="downloadResultFile(validationRun.id, 'netCDF', validationRun.output_file_name)"
                title="Download validation run .nc file">
          <span><fa-icon [icon]="faIcons.faFileDownload"></fa-icon></span>
        </button>
      </div>
      <button pButton
              routerLink="/validate/"
              class="dropdown-item"
              [queryParams]="{validation_id: validationRun.id}"
              title="Load validation settings"
              label="Load Validation Settings"
              icon="pi pi-replay">
      </button>
      <span *ngIf="validationRun.is_unpublished"
            [ngClass]="{'collapse': validationRun.publishing_in_progress}">
        <button pButton
                type="button"
                class="dropdown-item"
                title="Remove this validation run"
                label="Delete Validation Run"
                icon="pi pi-times"
                (click)=deleteValidation(validationRun.id)>
        </button>
        <button *ngIf="!(isArchived$|async)"
                pButton
                type="button"
                label="Extend Life Span"
                icon="pi pi-calendar-plus"
                class="dropdown-item"
                title="Extend lifespan of this validation run"
                (click)=extendResults(validationRun.id)>
        </button>
      </span>
    </div>
  </div>
  <!--published validations page only-->
  <span *ngIf="published">
    <button *ngIf="isLogged"
            pButton
            routerLink="/validate/"
            class="btn-action"
            [queryParams]="{validation_id: validationRun.id}"
            title="Load validation settings"
            icon="pi pi-replay">
      </button>
    <button *ngIf="isLogged && (isTrackedByTheUser$|async)"
            pButton
            type="button"
            icon="pi pi-times"
            class="btn-action"
            title="Remove this validation from your list"
            (click)="removeValidation(validationRun.id)">
    </button>
    <button *ngIf="isLogged && !(isTrackedByTheUser$|async)"
            pButton
            type="button"
            icon="pi pi-plus"
            class="btn-action"
            title="Pin this validation. Pinning results gives a quick access to it."
            (click)="addValidation(validationRun.id)"
            onclick="">
    </button>
  </span>


  <!--  tracked validations on custom validations page-->
  <span *ngIf="validationRun.output_file && tracked">
    <button pButton
            type="button"
            icon="pi pi-download"
            class="btn-action"
            (click)="downloadResultFile(validationRun.id, 'graphics',validationRun.id + '_graphs.zip')"
            title="Download graphs .zip">
    </button>
    <button pButton
            type="button"
            icon="faIcons.faFileDownload"
            class="btn-action"
            (click)="downloadResultFile(validationRun.id, 'netCDF', validationRun.output_file_name)"
            title="Download validation run .nc file">
      <span><fa-icon [icon]="faIcons.faFileDownload"></fa-icon></span>
    </button>
    <button *ngIf="isLogged"
            pButton
            type="button"
            icon="pi pi-times"
            class="btn-action"
            title="Remove this validation from your list"
            (click)="removeValidation(validationRun.id)">
    </button>
  </span>

</div>

<!--Buttons shown on the single validation page (both custom and published)-->
<div *ngIf="!validationList && !(publishingInProgress$|async)" class="col-sm p-pb-4" style="text-align: right;">
  <div *ngIf="isOwner && validationRun.is_unpublished; else elseSingleValidation" style="float: right"
       [ngClass]="{'collapse': validationRun.publishing_in_progress}">
    <button pButton
            type="button"
            icon="pi pi-times"
            class="btn-action-large"
            title="Remove result"
            label="Delete"
            (click)="deleteValidation(validationRun.id)">
    </button>

    <button *ngIf="isArchived$|async; else elseIsArchived"
            pButton
            type="button"
            icon="pi pi-calendar"
            class="btn-action-large"
            label="Un-archive"
            title="Un-archive"
            (click)="archiveResults(validationRun.id, false)">
    </button>

    <ng-template #elseIsArchived>
      <button pButton
              type="button"
              icon="pi pi-calendar-plus"
              class="btn-action-large"
              label="Renew"
              title="Extend lifespan"
              (click)="extendResults(validationRun.id)">
      </button>
      <button pButton
              type="button"
              icon="faIcons.faArchive"
              class="btn-action-large"
              label="Archive"
              title="Archive"
              (click)="archiveResults(validationRun.id, true)">
        <span><fa-icon [icon]="faIcons.faArchive"></fa-icon></span>
      </button>
    </ng-template>

    <button *ngIf="validationRun.output_file"
            pButton
            type="button"
            icon="pi pi-book"
            class="btn-action-large"
            label="Publish"
            title="Publish on Zenodo"
            data-toggle="modal"
            data-target="#publishDialog"
            (click)="open()">
    </button>

    <a *ngIf="isLogged"
       pButton
       type="button"
       icon="pi pi-replay"
       class="btn-action-large"
       label="Load settings"
       routerLink="/validate/"
       [queryParams]="{validation_id: validationRun.id}"
       title="Load settings"></a>

    <div [ngClass]="{'collapse': !validationRun.publishing_in_progress}"
         style="float: right">
      <div class="spinner-border spinner-border-sm" role="status">
        <span class="sr-only">Publishing in progress...</span>
      </div>
      Publishing in progress...
    </div>

  </div>


  <ng-template #elseSingleValidation>
    <div style="float: right;">
      <button *ngIf="isLogged && validationRun.is_unpublished" pButton
              type="button"
              icon="pi pi-copy"
              class="btn-action-large"
              title="If you copy this validation, it will be added to the list of your validations with all the result files. You will have a full control over the copy."
              label="Copy validation"
              (click)="copy(validationRun.id)">
      </button>

      <a *ngIf="isLogged"
         pButton
         type="button"
         icon="pi pi-replay"
         class="btn-action-large"
         label="Load settings"
         routerLink="/validate/"
         [queryParams]="{validation_id: validationRun.id}"
         title="Load settings">
      </a>

      <button *ngIf="isLogged && (isTrackedByTheUser$|async) && !validationRun.is_unpublished"
              pButton
              type="button"
              icon="pi pi-times"
              class="btn-action-large"
              label="Unpin validation"
              title="Remove this validation from your list"
              (click)="removeValidation(validationRun.id)">
      </button>

      <button *ngIf="isLogged && !(isTrackedByTheUser$|async) && !validationRun.is_unpublished"
              class="btn-action-large"
              pButton
              type="button"
              icon="pi pi-plus"
              label="Pin validation"
              title="Pinning results gives a quick access to it."
              (click)="addValidation(validationRun.id)">
      </button>

    </div>
  </ng-template>
</div>
<div *ngIf="!validationList && (publishingInProgress$|async)" class="col-sm p-pb-4 text-muted" id="publishingInProgress">
  <span class="pi pi-spin pi-spinner"></span> <span> Publishing in progress... </span>
</div>
